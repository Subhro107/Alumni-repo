<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country Weather Search</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --bg-light: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%, #90caf9 100%);
            --bg-dark: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --backdrop-blur: blur(20px);
            --font-color-light: #333333 !important;
            --font-color-dark: #e0e0e0 !important;
        }

        [data-bs-theme="dark"] {
            --bs-body-bg: #121212;
            --bs-body-color: #ffffff;
            --bs-card-bg: rgba(45, 45, 45, 0.9);
            --glass-bg: rgba(0, 0, 0, 0.2);
            --glass-border: rgba(255, 255, 255, 0.1);
            --font-color-light: #e0e0e0;
            --font-color-dark: #333333;
        }

        body {
            background: no-repeat center center fixed;
            background-size: cover;
            background-attachment: fixed;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s ease;
            color: var(--font-color-light);
            color: #333333;
        }
        
        h6{
            font-size: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
           
        }

        [data-bs-theme="dark"] body {
            background: var(--bg-dark);
             color: var(--font-color-dark);
        }

       /* Weather-specific backgrounds */
.weather-clear {
    background: var(--bg-light) url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed !important;
    background-size: cover;
}
[data-bs-theme="dark"] .weather-clear {
    background: var(--bg-dark) url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed !important;
    background-size: cover;
}
.weather-rain { /* Fixed syntax */
    background: var(--bg-light) url('https://images.unsplash.com/photo-1501854140801-50d01698950b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed !important;
    background-size: cover;
}
[data-bs-theme="dark"] .weather-rain {
    background: var(--bg-dark) url('https://images.unsplash.com/photo-1501854140801-50d01698950b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed !important;
    background-size: cover;
}
.weather-clouds {
    background: var(--bg-light) url('https://images.unsplash.com/photo-1446329813274-7c1b4e4e8a1a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed !important;
    background-size: cover;
}
[data-bs-theme="dark"] .weather-clouds {
    background: var(--bg-dark) url('https://images.unsplash.com/photo-1446329813274-7c1b4e4e8a1a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed !important;
    background-size: cover;
}
.weather-snow {
    background: var(--bg-light) url('https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed !important;
    background-size: cover;
}
[data-bs-theme="dark"] .weather-snow {
    background: var(--bg-dark) url('https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed !important;
    background-size: cover;
}

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-radius: 20px;
        }

        .gradient-btn {
            background: var(--primary-gradient);
            border: none;
            color: white;
            transition: all 0.3s ease;
            border-radius: 50px;
            padding: 12px 30px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .gradient-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.949), transparent);
            transition: left 0.5s;
        }

        .gradient-btn:hover:before {
            left: 100%;
        }

        .gradient-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .gradient-btn-secondary {
            background: var(--secondary-gradient);
        }

        .weather-icon {
            width: 60px;
            height: 60px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .country-flag {
            font-size: 4rem;
            text-shadow: 0 4px 8px rgba(0,0,0,0.1);
            line-height: 1;
        }

        .temperature {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--success-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            border-radius: 50px;
            padding: 10px 20px;
            background: rgb(233 233 233 / 76%);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid var(--glass-border);
            color: var(--bs-body-color);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .loading-content {
            background: var(--glass-bg);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            color: white;
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: var(--backdrop-blur);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            height: 100%;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }

        .search-container {
            max-width: 600px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .country-flag {
                font-size: 3rem;
            }
            
            .temperature {
                font-size: 2rem;
            }
        }

        .time-display {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--bs-primary);
        }

        .timezone-info {
            font-size: 0.9rem;
            opacity: 0.8;
        }
    </style>
</head>
<body data-bs-theme="light">
    <!-- Theme Toggle -->
    <button class="btn theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon"></i> Dark Mode
    </button>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay d-none">
        <div class="loading-content">
            <div class="spinner-border text-light mb-3" role="status"></div>
            <h5 id="loadingText" class="text-light">Loading...</h5>
        </div>
    </div>

    <div class="container py-5">
        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">
                <i class="fas fa-globe-americas"></i> Country Explorer
            </h1>
            <p class="lead">Discover countries and their capital city weather</p>
        </div>

        <!-- Search Section -->
        <div class="search-container mb-5">
            <div class="glass-card p-4">
                <form id="searchForm" onsubmit="searchCountry(event)">
                    <div class="row g-3">
                        <div class="col-md-8">
                            <div class="input-group">
                                <span class="input-group-text border-end-0">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input 
                                    type="text" 
                                    class="form-control border-start-0" 
                                    id="countryInput" 
                                    placeholder="Enter country name..."
                                    required
                                >
                            </div>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn gradient-btn w-100" id="searchBtn">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                </form>
                
                <div class="text-center mt-3">
                    <button type="button" class="btn gradient-btn gradient-btn-secondary" onclick="getCurrentLocation()">
                        <i class="fas fa-map-marker-alt"></i> Use My Location
                    </button>
                </div>
            </div>
        </div>

        <!-- Alert Messages -->
        <div id="alertContainer"></div>

        <!-- Results Section -->
        <div id="resultSection" class="d-none fade-in">
            <!-- Country Header -->
            <div class="glass-card p-4 mb-4">
                <div class="row align-items-center">
                    <div class="col-auto">
                        <div id="countryFlag" class="country-flag"></div>
                    </div>
                    <div class="col">
                        <h2 id="countryName" class="mb-1 fw-bold"></h2>
                        <p id="countryCapital" class="mb-0 fs-5">
                            <i class="fas fa-map-pin"></i> Capital: <span></span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="row g-4 mb-4">
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h5>Population</h5>
                        <p id="countryPopulation" class="h4 fw-bold text-primary mb-0"></p>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <h5>Region</h5>
                        <p id="countryRegion" class="h5 fw-bold text-success mb-0"></p>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-expand-arrows-alt"></i>
                        </div>
                        <h5>Area</h5>
                        <p id="countryArea" class="h5 fw-bold text-info mb-0"></p>
                    </div>
                </div>
                
                <div class="col-md-6 col-lg-3">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h5>Local Time</h5>
                        <div id="localTime" class="time-display">--:--</div>
                        <div id="timezone" class="timezone-info"></div>
                    </div>
                </div>
            </div>

            <!-- Weather Section -->
            <div class="glass-card p-4">
                <h3 class="mb-3">
                    <i class="fas fa-cloud-sun text-primary"></i> 
                    Current Weather in <span id="weatherCity"></span>
                </h3>
                <div id="weatherContent" class="row align-items-center">
                    <div class="col-auto">
                        <img id="weatherIcon" class="weather-icon" src="" alt="Weather icon">
                    </div>
                    <div class="col-auto">
                        <div id="temperature" class="temperature">--°C</div>
                        <div id="weatherDescription" class="h5 text-capitalize"></div>
                    </div>
                    <div class="col">
                        <div class="row text-center">
                            <div class="col">
                                <div class="h6 ">Feels Like</div>
                                <div id="feelsLike" class="h5 fw-bold">--°C</div>
                            </div>
                            <div class="col">
                                <div class="h6">Humidity</div>
                                <div id="humidity" class="h5 fw-bold">--%</div>
                            </div>
                            <div class="col">
                                <div class="h6">Wind Speed</div>
                                <div id="windSpeed" class="h5 fw-bold">-- m/s</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Configuration
        const CONFIG = {
            WEATHER_API_KEY: '10a6e605b54b5d63cba25234d32320b3',
        };

        let timeInterval = null;

        // Theme management
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const toggle = document.querySelector('.theme-toggle');
            toggle.innerHTML = newTheme === 'dark' 
                ? '<i class="fas fa-sun"></i> Light Mode' 
                : '<i class="fas fa-moon"></i> Dark Mode';
        }

        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-bs-theme', savedTheme);
            
            const toggle = document.querySelector('.theme-toggle');
            toggle.innerHTML = savedTheme === 'dark' 
                ? '<i class="fas fa-sun"></i> Light Mode' 
                : '<i class="fas fa-moon"></i> Dark Mode';
        }

       // Show/hide loading
        function showLoading(text = 'Loading...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.remove('d-none');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('d-none');
        } 

        // Show alerts
        function showAlert(message, type = 'danger') {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert-' + Date.now();
            
            const alertHTML = `
                <div id="${alertId}" class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'danger' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            alertContainer.innerHTML = alertHTML;
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                const alertElement = document.getElementById(alertId);
                if (alertElement) {
                    const bsAlert = new bootstrap.Alert(alertElement);
                    bsAlert.close();
                }
            }, 5000);
        }

        // Format population
        function formatPopulation(population) {
            if (population >= 1000000) {
                return (population / 1000000).toFixed(1) + 'M';
            } else if (population >= 1000) {
                return (population / 1000).toFixed(1) + 'K';
            }
            return population.toLocaleString();
        }

        // Format area
        function formatArea(area) {
            return area.toLocaleString() + ' km²';
        }

        // Fetch country data
        async function fetchCountryData(countryName) {
            try {
                const response = await fetch(
                    `https://restcountries.com/v3.1/name/${encodeURIComponent(countryName)}?fullText=false`
                );
                
                if (!response.ok) {
                    throw new Error('Country not found');
                }
                
                const data = await response.json();
                const country = data[0];
                
                return {
                    name: country.name.common,
                    capital: country.capital ? country.capital[0] : 'N/A',
                    population: country.population,
                    region: country.region,
                    subregion: country.subregion,
                    area: country.area,
                    flag: country.flag,
                    timezones: country.timezones,
                    latlng: country.latlng,
                    capitalInfo: country.capitalInfo
                };
            } catch (error) {
                throw new Error('Failed to fetch country data. Please check the country name and try again.');
            }
        }

        // Fetch weather data
        async function fetchWeatherData(cityName) {
            if (!CONFIG.WEATHER_API_KEY || CONFIG.WEATHER_API_KEY === 'YOUR_API_KEY_HERE') {
                throw new Error('Weather API key not configured');
            }

            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(cityName)}&appid=${CONFIG.WEATHER_API_KEY}&units=metric`
                );
                
                if (!response.ok) {
                    throw new Error('Weather data not found');
                }
                
                return await response.json();
            } catch (error) {
                throw new Error('Failed to fetch weather data');
            }
        }
        // Get timezone and time
      async function getTimezoneTime(timezone) {
      try {
       const now = new Date();

      // Case 1: IANA timezone 
       if (/^[A-Za-z]+\//.test(timezone)) {
      const options = {
        timeZone: timezone,
        hour12: true,
        hour: 'numeric',
        minute: 'numeric',
        second: 'numeric'
      };
      return {
        time: now.toLocaleTimeString('en-US', options),
        timezone: timezone
      };
    }

    // Case 2: UTC offset 
    const match = timezone.match(/^UTC([+-]\d{2}):?(\d{2})?$/);
    if (match) {
      const offsetHours = parseInt(match[1], 10);
      const offsetMinutes = parseInt(match[2] || "0", 10);

      // Calculate time with offset
      const utc = now.getTime() + now.getTimezoneOffset() * 60000;
      const local = new Date(utc + (offsetHours * 60 + offsetMinutes) * 60000);

      return {
        time: local.toLocaleTimeString('en-US', { hour12: true }),
        timezone: timezone
      };
    }

    // If format not recognized
    return {
      time: 'Time unavailable',
      timezone: 'Unknown format'
    };
  } catch (error) {
    console.error('Timezone error:', error);
    return {
      time: 'Time unavailable',
      timezone: 'Error'
      };
     }
        }


        // Update time display
        function updateTimeDisplay(timezone) {
            if (timeInterval) {
                clearInterval(timeInterval);
            }
            
            function updateTime() {
                try {
                    const now = new Date();
                    const options = {
                        timeZone: timezone,
                        hour12: true,
                        hour: 'numeric',
                        minute: 'numeric',
                        second: 'numeric'
                    };
                    
                    const time = now.toLocaleTimeString('en-US', options);
                    document.getElementById('localTime').textContent = time;
                    document.getElementById('timezone').textContent = timezone;
                } catch (error) {
                    document.getElementById('localTime').textContent = 'Time unavailable';
                    document.getElementById('timezone').textContent = '';
                }
            }
            
            updateTime();
            timeInterval = setInterval(updateTime, 1000);
        }

        // Display results
        function displayResult(countryData, weatherData) {
            // Country basic info
            document.getElementById('countryFlag').textContent = countryData.flag;
            document.getElementById('countryName').textContent = countryData.name;
            document.getElementById('countryCapital').querySelector('span').textContent = countryData.capital;
            
            // Stats
            document.getElementById('countryPopulation').textContent = formatPopulation(countryData.population);
            document.getElementById('countryRegion').textContent = countryData.region + 
                (countryData.subregion ? ` (${countryData.subregion})` : '');
            document.getElementById('countryArea').textContent = formatArea(countryData.area);
            
            // Time
           if (countryData.timezones && countryData.timezones[0]) {
            getTimezoneTime(countryData.timezones[0]).then(({ time, timezone }) => {
             document.getElementById('localTime').textContent = time;
             document.getElementById('timezone').textContent = timezone;
              });
            } else {
             document.getElementById('localTime').textContent = 'Time unavailable';
             document.getElementById('timezone').textContent = '';
        }
            
            // Weather
            if (weatherData) {
                document.getElementById('weatherCity').textContent = countryData.capital;
                document.getElementById('weatherIcon').src = 
                    `https://openweathermap.org/img/wn/${weatherData.weather[0].icon}@2x.png`;
                document.getElementById('weatherIcon').alt = weatherData.weather[0].description;
                document.getElementById('temperature').textContent = 
                    Math.round(weatherData.main.temp) + '°C';
                document.getElementById('weatherDescription').textContent = 
                    weatherData.weather[0].description;
                document.getElementById('feelsLike').textContent = 
                    Math.round(weatherData.main.feels_like) + '°C';
                document.getElementById('humidity').textContent = 
                    weatherData.main.humidity + '%';
                document.getElementById('windSpeed').textContent = 
                    weatherData.wind.speed + ' m/s';
                // Set background based on weather
        const weatherMain = weatherData.weather[0].main.toLowerCase();
        const body = document.body;
        body.classList.remove('weather-clear', 'weather-rain', 'weather-clouds', 'weather-snow');
        if (weatherMain === 'clear') {
            body.classList.add('weather-clear');
        } else if (weatherMain === 'rain') {
            body.classList.add('weather-rain');
        } else if (weatherMain === 'clouds') {
            body.classList.add('weather-clouds');
        } else if (weatherMain === 'snow') {
            body.classList.add('weather-snow');
        } else {
            body.classList.add('weather-clear'); // Default to clear sky
        }
            } else {
                document.getElementById('weatherCity').textContent = countryData.capital;
                document.getElementById('weatherContent').innerHTML = 
                    '<div class="col"><p class="text-muted">Weather data unavailable</p></div>';
            }
            
            // Show results
            document.getElementById('resultSection').classList.remove('d-none');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Main search function
        async function searchCountry(event) {
            event.preventDefault();
            
            const countryName = document.getElementById('countryInput').value.trim();
            if (!countryName) return;
            
            const searchBtn = document.getElementById('searchBtn');
            const originalBtnHTML = searchBtn.innerHTML;
            
            try {
                // Disable button and show loading
                searchBtn.disabled = true;
                searchBtn.innerHTML = '<i class="fas fa-search"></i> Search';
                showLoading('Searching for country...');
                
                // Clear previous results
                document.getElementById('resultSection').classList.add('d-none');
                document.getElementById('alertContainer').innerHTML = '';
                
                // Fetch country data
                const countryData = await fetchCountryData(countryName);
                
                // Fetch weather data
                showLoading(`Getting weather for ${countryData.capital}...`);
                let weatherData = null;
                
                if (countryData.capital && countryData.capital !== 'N/A') {
                    try {
                        weatherData = await fetchWeatherData(countryData.capital);
                    } catch (weatherError) {
                        console.warn('Weather data unavailable:', weatherError);
                        showAlert('Weather data is temporarily unavailable', 'warning');
                    }
                }
                
                // Display results
                displayResult(countryData, weatherData);
                
            } catch (error) {
                showAlert(error.message);
            } finally {
                // Re-enable button and hide loading
                searchBtn.disabled = false;
                searchBtn.innerHTML = originalBtnHTML;
                hideLoading();
            }
        }

        // Geolocation functionality
        async function getCurrentLocation() {
            if (!navigator.geolocation) {
                showAlert('Geolocation is not supported by this browser.');
                return;
            }

            const locationBtn = document.querySelector('[onclick="getCurrentLocation()"]');
            const originalBtnHTML = locationBtn.innerHTML;
            
            try {
                // Disable button and show loading
                locationBtn.disabled = true;
                locationBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Getting Location...';
                showLoading('Getting your location...');
                
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        try {
                            const { latitude, longitude } = position.coords;
                            
                            showLoading('Finding your country...');
                            
                            // Use reverse geocoding
                            const response = await fetch(
                                `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`
                            );
                            
                            if (!response.ok) {
                                throw new Error('Unable to determine your location');
                            }
                            
                            const locationData = await response.json();
                            const countryName = locationData.countryName;
                            
                            if (!countryName) {
                                throw new Error('Unable to determine your country');
                            }
                            
                            // Set the country in the input
                            document.getElementById('countryInput').value = countryName;
                            
                            // Trigger search
                            const countryData = await fetchCountryData(countryName);
                            
                            showLoading(`Getting weather for ${countryData.capital}...`);
                            let weatherData = null;
                            
                            if (countryData.capital && countryData.capital !== 'N/A') {
                                try {
                                    weatherData = await fetchWeatherData(countryData.capital);
                                } catch (weatherError) {
                                    console.warn('Weather data unavailable:', weatherError);
                                    showAlert('Weather data is temporarily unavailable', 'warning');
                                }
                            }
                            
                            displayResult(countryData, weatherData);
                            
                        } catch (error) {
                            showAlert(`Location error: ${error.message}`);
                        } finally {
                            // IMPORTANT: Always re-enable button and hide loading
                            locationBtn.disabled = false;
                            locationBtn.innerHTML = originalBtnHTML;
                            hideLoading();
                        }
                    },
                    (error) => {
                        hideLoading();
                        locationBtn.disabled = false;
                        locationBtn.innerHTML = originalBtnHTML;
                        
                        let errorMessage = 'Unable to get your location. ';
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage += 'Location access was denied.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage += 'Location information is unavailable.';
                                break;
                            case error.TIMEOUT:
                                errorMessage += 'Location request timed out.';
                                break;
                            default:
                                errorMessage += 'An unknown error occurred.';
                                break;
                        }
                        showAlert(errorMessage);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } catch (error) {
                locationBtn.disabled = false;
                locationBtn.innerHTML = originalBtnHTML;
                hideLoading();
                showAlert(`Error: ${error.message}`);
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            
            // Add search functionality
            document.getElementById('searchForm').addEventListener('submit', searchCountry);
            
            // Add some example suggestions
            const examples = ['Japan', 'France', 'Brazil', 'Canada', 'Australia', 'India'];
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            document.getElementById('countryInput').placeholder = 
                `Enter country name (e.g., ${randomExample})`;
        });

        // Cleanup interval on page unload
        window.addEventListener('beforeunload', function() {
            if (timeInterval) {
                clearInterval(timeInterval);
            }
        });
    </script>
</body>
</html>